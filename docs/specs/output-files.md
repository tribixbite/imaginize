# Output Files Specification

This document specifies the format and structure of the Markdown files generated by imaginize.

## Overview

imaginize generates three primary output files:
1. **Contents.md** - Table of contents and usage guide
2. **Chapters.md** - Visual scenes organized by chapter
3. **Elements.md** - Catalog of story elements (characters, places, items)

All files use GitHub Flavored Markdown and are designed to be human-readable reference guides for illustrators.

## File Locations

Output files are generated in the `illustrate_BOOKNAME/` directory:

```
illustrate_BOOKNAME/
├── Contents.md          # Main table of contents
├── Chapters.md          # Visual scenes by chapter
├── Elements.md          # Story elements catalog
├── data/                # Internal data files
│   ├── character-registry.json
│   └── style-guide.json
├── images/              # Generated images
│   ├── chapter_1_scene_1.png
│   ├── chapter_1_scene_2.png
│   └── ...
└── .illustrate.state.json  # State tracking
```

---

## Contents.md Format

### Purpose
Serves as the main entry point, providing an overview of the generated documentation and usage instructions.

### Structure

```markdown
# [Book Title]

**Author:** [Author Name]
**Publisher:** [Publisher Name]
**Total Pages:** [Page Count]

---

## Generated Documentation

This illustration guide contains:

- **[Chapters.md](./Chapters.md)** - [N] visual scenes organized by chapter
- **[Elements.md](./Elements.md)** - [N] story elements (characters, places, items)

---

## How to Use This Guide

1. **Chapters.md**: Browse visual scenes chapter by chapter. Each scene includes exact quotes from the source text and factual descriptions.

2. **Elements.md**: Reference catalog of characters, creatures, places, and items with multiple source quotes for accurate illustration.

3. **Cross-Reference**: When illustrating a scene mentioning a character or place, check Elements.md for their complete description.
```

### Example

```markdown
# The Hobbit

**Author:** J.R.R. Tolkien
**Publisher:** George Allen & Unwin
**Total Pages:** 310

---

## Generated Documentation

This illustration guide contains:

- **[Chapters.md](./Chapters.md)** - 47 visual scenes organized by chapter
- **[Elements.md](./Elements.md)** - 23 story elements (characters, places, items)

---

## How to Use This Guide

1. **Chapters.md**: Browse visual scenes chapter by chapter. Each scene includes exact quotes from the source text and factual descriptions.

2. **Elements.md**: Reference catalog of characters, creatures, places, and items with multiple source quotes for accurate illustration.

3. **Cross-Reference**: When illustrating a scene mentioning a character or place, check Elements.md for their complete description.
```

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| Title | string | Yes | Book title from metadata |
| Author | string | Optional | Author name if available |
| Publisher | string | Optional | Publisher if available |
| Total Pages | number | Optional | Page count if available |
| Chapters Count | number | Yes | Number of scenes in Chapters.md |
| Elements Count | number | Yes | Number of elements in Elements.md |

---

## Chapters.md Format

### Purpose
Organizes visual scenes by chapter, providing exact quotes and descriptions for illustration reference.

### Structure

```markdown
# Chapters - [Book Title]

## Visual Scenes by Chapter

Each scene includes exact quotes from the source text for illustration reference.

---

### [Chapter Title]

#### Scene [N]

**Pages:** [Page Range] (Lines [Start]-[End])

**Source Text:**
> [Exact quote from book]

**Visual Elements:** [Description of what to illustrate]

**Generated Image:** [View Image]([URL])

---

#### Scene [N+1]

...
```

### Example

```markdown
# Chapters - The Hobbit

## Visual Scenes by Chapter

Each scene includes exact quotes from the source text for illustration reference.

---

### Chapter 1: An Unexpected Party

#### Scene 1

**Pages:** 1-2 (Lines 15-28)

**Source Text:**
> In a hole in the ground there lived a hobbit. Not a nasty, dirty, wet hole, filled with the ends of worms and an oozy smell, nor yet a dry, bare, sandy hole with nothing in it to sit down on or to eat: it was a hobbit-hole, and that means comfort.

**Visual Elements:** Cozy hobbit-hole interior with round green door, wooden furnishings, warm lighting from lanterns, comfortable armchairs, pantries visible in background. Bilbo Baggins sitting contentedly near fireplace.

**Generated Image:** [View Image](./images/chapter_1_scene_1.png)

---

#### Scene 2

**Pages:** 5-6 (Lines 42-53)

**Source Text:**
> Gandalf! If you had heard only a quarter of what I have heard about him, and I have only heard very little of all there is to hear, you would be prepared for any sort of remarkable tale. Tales and adventures sprouted up all over the place wherever he went, in the most extraordinary fashion.

**Visual Elements:** Gandalf the Grey wizard arriving at Bilbo's door. Tall figure in grey robes and pointed hat, long grey beard, wooden staff, penetrating eyes. Round green door of hobbit-hole visible behind him.

**Generated Image:** [View Image](./images/chapter_1_scene_2.png)

---

### Chapter 2: Roast Mutton

#### Scene 3

...
```

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| Chapter Title | string | Yes | Chapter name/number |
| Scene Number | number | Yes | Sequential scene number within chapter |
| Pages | string | Yes | Page range (e.g., "15-17") |
| Lines | string | Optional | Line numbers if available |
| Source Text | string | Yes | Exact quote from book (blockquote) |
| Visual Elements | string | Yes | Description of what to illustrate |
| Generated Image | string | Optional | Link to generated image if available |

### Sorting
- Chapters appear in book order
- Scenes within each chapter are sequential by page number

---

## Elements.md Format

### Purpose
Provides a reference catalog of recurring story elements (characters, creatures, places, items) with multiple quotes for accurate visual consistency.

### Structure

```markdown
# Elements - [Book Title]

**Author:** [Author Name]

---

## Story Elements

This document catalogs key characters, creatures, places, items, and objects mentioned in the book, with direct quotes for accurate illustration reference.

### Characters

#### [Character Name]

**Description:** [Brief description]

**Reference Quotes:**

1. (Page [N])
   > [Quote 1]

2. (Page [N])
   > [Quote 2]

**Generated Image:** [View Image]([URL])

---

### Creatures

#### [Creature Name]

...

### Places

#### [Place Name]

...

### Items

#### [Item Name]

...

### Objects

#### [Object Name]

...

## Statistics

- **Characters:** [N]
- **Creatures:** [N]
- **Places:** [N]
- **Items:** [N]
- **Objects:** [N]
```

### Example

```markdown
# Elements - The Hobbit

**Author:** J.R.R. Tolkien

---

## Story Elements

This document catalogs key characters, creatures, places, items, and objects mentioned in the book, with direct quotes for accurate illustration reference.

### Characters

#### Bilbo Baggins

**Description:** Respectable hobbit of Bag End, comfortable and unadventurous, about 50 years old, enjoys his routine and comforts.

**Reference Quotes:**

1. (Page 1)
   > In a hole in the ground there lived a hobbit. Not a nasty, dirty, wet hole, filled with the ends of worms and an oozy smell, nor yet a dry, bare, sandy hole with nothing in it to sit down on or to eat: it was a hobbit-hole, and that means comfort.

2. (Page 3)
   > He had a tall pointed blue hat, a long grey cloak, a silver scarf over which his long white beard hung down below his waist, and immense black boots.

3. (Page 15)
   > Bilbo Baggins, a hobbit of comfort and respectability, had little use for adventures. He was well-to-do, which meant he could afford the best food, the softest armchairs, and the most agreeable society.

**Generated Image:** [View Image](./images/bilbo_baggins.png)

---

#### Gandalf

**Description:** Tall wizard with grey robes, pointed hat, long grey beard, wooden staff, wise and mysterious.

**Reference Quotes:**

1. (Page 3)
   > He had a tall pointed blue hat, a long grey cloak, a silver scarf over which his long white beard hung down below his waist, and immense black boots.

2. (Page 6)
   > "I am looking for someone to share in an adventure that I am arranging, and it's very difficult to find anyone." - "I should think so - in these parts! We are plain quiet folk and have no use for adventures. Nasty disturbing uncomfortable things! Make you late for dinner!"

**Generated Image:** [View Image](./images/gandalf.png)

---

### Places

#### Bag End

**Description:** Bilbo's hobbit-hole, luxurious and comfortable with round doors and windows, wood-paneled rooms, many pantries.

**Reference Quotes:**

1. (Page 2)
   > It had a perfectly round door like a porthole, painted green, with a shiny yellow brass knob in the exact middle. The door opened on to a tube-shaped hall like a tunnel: a very comfortable tunnel without smoke, with panelled walls, and floors tiled and carpeted, provided with polished chairs, and lots and lots of pegs for hats and coats - the hobbit was fond of visitors.

2. (Page 4)
   > The mother of our particular hobbit - what is a hobbit? I suppose hobbits need some description nowadays, since they have become rare and shy of the Big People, as they call us. They are (or were) a little people, about half our height, and smaller than the bearded Dwarves. Hobbits have no beards. There is little or no magic about them, except the ordinary everyday sort which helps them to disappear quietly and quickly when large stupid folk like you and me come blundering along, making a noise like elephants which they can hear a mile off.

**Generated Image:** [View Image](./images/bag_end.png)

---

## Statistics

- **Characters:** 8
- **Creatures:** 5
- **Places:** 7
- **Items:** 2
- **Objects:** 1
```

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| Element Name | string | Yes | Name of character/place/item |
| Type | enum | Yes | character, creature, place, item, object |
| Description | string | Optional | Brief visual description |
| Reference Quotes | Quote[] | Yes | Array of quotes with page numbers |
| Generated Image | string | Optional | Link to generated image if available |

### Quote Object

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| Page | number | Yes | Page number where quote appears |
| Text | string | Yes | Exact quote from book |

### Element Types

- **Characters**: Named people (protagonists, supporting characters)
- **Creatures**: Non-human entities (dragons, goblins, animals)
- **Places**: Locations (towns, buildings, landscapes)
- **Items**: Physical objects with significance (weapons, jewelry, artifacts)
- **Objects**: General physical objects

### Sorting
- Elements grouped by type in fixed order: Characters → Creatures → Places → Items → Objects
- Within each type, elements are alphabetically sorted by name

---

## Cross-References

### Chapters.md → Elements.md
When a scene mentions an element (character, place, etc.), users can reference Elements.md for complete visual details.

**Example:**
- Scene in Chapters.md: "Bilbo opened the round green door of Bag End"
- User checks Elements.md for detailed descriptions of both "Bilbo Baggins" and "Bag End"

### Elements.md → Chapters.md
Element quotes often reference specific scenes that appear in Chapters.md.

**Example:**
- Element quote: "(Page 15) Chapter 2 scene description"
- User can find the full scene context in Chapters.md

---

## File Format Standards

### Markdown Compliance
- GitHub Flavored Markdown (GFM)
- UTF-8 encoding
- Line endings: LF (Unix-style)

### Blockquotes
All source text quotes use Markdown blockquote syntax:
```markdown
> Quoted text from the book
```

### Links
All links use Markdown link syntax:
```markdown
[Link Text](./relative/path.ext)
```

### Headings
- H1 (`#`): File title
- H2 (`##`): Major sections
- H3 (`###`): Chapter/Element type sections
- H4 (`####`): Individual scenes/elements

### Horizontal Rules
Section separators use triple dashes:
```markdown
---
```

---

## Generation Process

### Contents.md
1. Extract metadata from parsed book
2. Count chapters and elements
3. Generate template with book info
4. Write to `Contents.md`

### Chapters.md
1. Group visual concepts by chapter
2. Sort by page number within each chapter
3. Format each scene with quote and description
4. Add image links if images were generated
5. Write to `Chapters.md`

### Elements.md
1. Collect all extracted elements
2. Group by type (character, creature, place, item, object)
3. Sort alphabetically within each type
4. Format each element with quotes
5. Add statistics section
6. Write to `Elements.md`

---

## File Size Considerations

### Typical Sizes
- **Contents.md**: 1-2 KB (small, fixed template)
- **Chapters.md**: 50-500 KB (scales with book length and scene count)
- **Elements.md**: 20-200 KB (scales with element count and quote length)

### Large Book Handling
For very large books (>1000 pages), output files may exceed 1 MB. Consider:
- Splitting Chapters.md by book section (Part I, Part II, etc.)
- Limiting quote length to ~200 characters per quote
- Generating separate files per 100-200 scenes

---

## Validation

### Contents.md
- ✅ Title is present
- ✅ Chapter and element counts match actual files
- ✅ Links to Chapters.md and Elements.md are valid

### Chapters.md
- ✅ All chapters are represented
- ✅ Scenes are sequentially numbered within each chapter
- ✅ All scenes have source text (blockquote)
- ✅ All scenes have visual element descriptions
- ✅ Page ranges are valid (start ≤ end)
- ✅ Image links point to existing files (if images generated)

### Elements.md
- ✅ All elements have at least one reference quote
- ✅ Elements are grouped by correct type
- ✅ Elements are alphabetically sorted within type
- ✅ Statistics match actual element counts
- ✅ All page numbers are valid integers

---

## Related Files

- [State Management](./state-management.md) - `.illustrate.state.json` format
- [Pipeline Architecture](./pipeline-architecture.md) - How output files are generated
- [Configuration](./configuration.md) - Output directory settings

---

**Status**: Complete ✅
**Last Updated**: 2025-11-14
**Version**: 2.7.0+
